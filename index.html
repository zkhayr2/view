<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Senarai RSVP</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { 
      getFirestore, collection, onSnapshot, query, orderBy
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // ðŸ”¹ Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyAyXoBcnGabIuKSaCjso_hA5CsCDqKnNek",
      authDomain: "wedding-guestbook-2086a.firebaseapp.com",
      projectId: "wedding-guestbook-2086a",
      storageBucket: "wedding-guestbook-2086a.firebasestorage.app",
      messagingSenderId: "54243617499",
      appId: "1:54243617499:web:bde886a3be0540492dfafe",
      measurementId: "G-CW3N7JZ6NT"
    };

    // Init Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Search function
    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById('searchInput').addEventListener('keyup', function() {
        let filter = this.value.toLowerCase();
        let rows = document.querySelectorAll('#rsvp-table-body tr');

        rows.forEach(row => {
          let nameCell = row.cells[1].textContent.toLowerCase(); // column Nama
          if (nameCell.indexOf(filter) > -1) {
            row.style.display = "";
          } else {
            row.style.display = "none";
          }
        });
      });
    });

    // ðŸ”¹ Listen RSVP data
    function listenRSVPs() {
      const rsvpsRef = collection(db, "rsvps");
      const q = query(rsvpsRef, orderBy("name", "asc"));

      onSnapshot(q, (snapshot) => {
        let total = 0;
        let tableRows = "";
        let index = 1;

        snapshot.forEach((docSnap) => {
          const data = docSnap.data();
          const name = data.name || "-";
          const attending = data.attending || "no";
          const pax = data.pax || 0;
          const note = data.note || "";

          // Kira total pax
          if (attending === "yes") {
            total += pax;
          }

          // Checkbox ikut status hadir (visual sahaja)
          const checked = attending === "yes" ? "checked" : "";

          tableRows += `
            <tr>
              <td style="text-align:center;">${index++}</td>
              <td>${name}</td>
              <td style="text-align:center;">${attending}</td>
              <td style="text-align:center;">${pax}</td>
              <td>${note}</td>
              <td style="text-align:center; display:none;">
                <input type="checkbox" ${checked} disabled>
              </td>
              <td style="text-align:center;">
                <input type="checkbox">
              </td>
            </tr>
          `;
        });

        // Update HTML
        document.getElementById("rsvp-table-body").innerHTML = tableRows;
        document.getElementById("total-pax").innerText = total;
      });
    }

    listenRSVPs();
  </script>
</head>
<body style="font-family: Arial, sans-serif; text-align:center; padding:20px;">

  <h2>Senarai RSVP</h2>

  <!-- Jumlah Pax -->
  <h3>Jumlah Pax Hadir: <span id="total-pax">0</span></h3>

  <!-- Search bar -->
  <input type="text" id="searchInput" placeholder="Cari nama..." 
         style="margin-bottom:10px; padding:5px; width:200px;">

  <!-- Table -->
  <table border="1" cellpadding="10" cellspacing="0" style="margin:auto; border-collapse: collapse; width:90%;">
    <thead style="background:#f2f2f2;">
      <tr>
        <th style="text-align:center;">Bil.</th>
        <th style="text-align:left;">Nama</th>
        <th style="text-align:center;">Kehadiran</th>
        <th style="text-align:center;">Pax</th>
        <th style="text-align:left;">Ucapan/Nota</th>
        <th style="text-align:center; display:none">Tick Hadir</th>
        <th style="text-align:center;">Check(/)</th>
      </tr>
    </thead>
    <tbody id="rsvp-table-body">
      <!-- Data akan muncul sini -->
    </tbody>
  </table>

</body>
</html>
